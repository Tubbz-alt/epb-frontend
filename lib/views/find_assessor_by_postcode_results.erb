<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <a
      href="<%= localised_url('/find-an-assessor')%>"
      class="govuk-back-link">
      <%=t('layout.body.breadcrumb.back')%>
    </a>

    <h1 class="govuk-heading-xl">
      <%= t('find_assessor_by_postcode_results.top_heading') %>
    </h1>

    <form method="GET" action="<%=localised_url('/find-an-assessor/search-by-postcode')%>" >
      <% if I18n.locale != I18n.available_locales[0] %>
        <input type="hidden" name="lang" value="<%= I18n.locale.to_s %>">
      <% end %>
      <fieldset class="govuk-fieldset fieldset-background">
        <div class="govuk-form-group<% if errors[:postcode] %> govuk-form-group--error<% end %>">
          <label class="govuk-label" for="postcode">
            <%= t('find_assessor_by_postcode.question') %>
          </label>
          <span id="postcode-hint" class="govuk-hint">
            <%= t('find_assessor_by_postcode.hint') %>
          </span>
          <% if errors[:postcode] %>
          <span id="postcode-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span><%= errors[:postcode] %>
          </span>
          <% end %>
          <input id="postcode" name="postcode" type="text"
                 class="govuk-input<% if errors[:postcode] %> govuk-input--error<% end %>"
                 aria-describedby="postcode-hint<% if errors[:postcode] %> postcode-error<% end %>"
                 autocomplete="postal-code"
                 spellcheck="false"
                 <% if params['postcode'] %>value="<%= params['postcode'].upcase %>"<% end %>
          >
        </div>

        <button class="govuk-button" data-module="govuk-button"><%= t('find_assessor_by_postcode.button_text') %></button>
      </fieldset>
    </form>

    <% if results.size > 0 %>
      <div class="govuk-grid-row">
        <p class="govuk-body">
          <%= t('find_assessor_by_postcode_results.description') %>
        </p>
      </div>

      <details class="govuk-details" data-module="govuk-details">
        <summary class="govuk-details__summary">
          <span class="govuk-details__summary-text">
            <%= t('find_assessor_by_postcode_results.accreditation_summary_title') %>
          </span>
        </summary>
        <div class="govuk-details__text">
          <%= t('find_assessor_by_postcode_results.accreditation_summary_text') %>
          <ul>
            <li><%= t('find_assessor_by_postcode_results.accreditation_summary_assess') %></li>
            <li><%= t('find_assessor_by_postcode_results.accreditation_summary_create') %></li>
          </ul>
        </div>
      </details>

      <h2 class="govuk-heading-m"><%= t('find_assessor_by_postcode_results.results', :quantity=>results.length, :postcode=>params['postcode'].upcase) %></h2>
      <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">


      <ul class="govuk-list">
          <% results.each do |result| %>
          <% assessor = result[:assessor] %>
            <li>
              <div>
                <h2 class="govuk-heading-m"><%= "#{assessor[:firstName]} #{assessor[:lastName]}" %></h2>
                <div>
                  <dl class="govuk-summary-list govuk-summary-list--no-border">
                    <div class="govuk-summary-list__row govuk-!-padding-bottom-0 govuk-!-margin-bottom-0">
                      <dt class="govuk-summary-list__key govuk-!-padding-bottom-0 govuk-!-margin-bottom-0"><%= t('find_assessor_by_postcode_results.contact_details.telephone') %></dt>
                      <dd class="govuk-summary-list__value govuk-!-padding-bottom-0 govuk-!-margin-bottom-0">
                        <p>
                          <a href="tel:<%= assessor[:contactDetails][:telephoneNumber] %>"><%= assessor[:contactDetails][:telephoneNumber] %></a>
                        </p>
                      </dd>
                    </div>
                    <div class="govuk-summary-list__row">
                      <dt class="govuk-summary-list__key"><%= t('find_assessor_by_postcode_results.contact_details.email') %></dt>
                      <dd class="govuk-summary-list__value">
                        <p>
                          <a href="mailto:<%= assessor[:contactDetails][:email] %>"><%= assessor[:contactDetails][:email] %></a>
                        </p>
                      </dd>
                    </div>
                    <div class="govuk-summary-list__row govuk-!-padding-bottom-0 govuk-!-margin-bottom-0">
                      <dt class="govuk-summary-list__key govuk-!-padding-bottom-0 govuk-!-margin-bottom-0 govuk-!-font-size-16"><%= t('find_assessor_by_postcode_results.accredited_scheme') %></dt>
                      <dd class="govuk-summary-list__value govuk-!-padding-bottom-0 govuk-!-margin-bottom-0"><%= assessor[:registeredBy][:name] %></dd>
                    </div>
                    <div class="govuk-summary-list__row">
                      <dt class="govuk-summary-list__key govuk-!-font-size-16"><%= t('find_assessor_by_postcode_results.accredited_id') %></dt>
                      <dd class="govuk-summary-list__value"><%= assessor[:registeredBy][:schemeId] %></dd>
                    </div>
                  </dl>
                </div>
              </div>
              <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
            </li>
          <% end %>
      </ul>
    <% else %>
      <p class="govuk-body">
        <%= t('find_assessor_by_postcode_results.no_assessors') %>
      </p>
    <% end %>
  </div>
</div>
