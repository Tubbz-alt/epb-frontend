<div class="govuk-grid-row">
  <div class="govuk-!-padding-left-3">
    <div class="govuk-body">
      <a
        href="<%= localised_url('/find-a-certificate')%>"
        class="govuk-back-link">
        <%=t('layout.body.breadcrumb.back')%>
      </a>
      <h1 class="govuk-heading-xl">
        <%= t('domestic_epc.top_heading') %>
      </h1>
    </div>
  </div>
  <div class="govuk-grid-column-one-third">
    <div class="related-links">
      <hr class="epc-blue-top"/>
      <h3 class="govuk-heading-m" id="contents"><%= t('domestic_epc.sidebar.title') %></h3>
      <div class="dashed-p">
        <p class="govuk-body"><a href="#renting"><%= t('domestic_epc.sidebar.sections.renting') %></a></p>
        <p class="govuk-body"><a href="#epc"><%= t('domestic_epc.sidebar.sections.epc') %></a></p>
        <p class="govuk-body"><a href="#summary"><%= t('domestic_epc.sidebar.sections.summary') %></a></p>
        <p class="govuk-body"><a href="#energy"><%= t('domestic_epc.sidebar.sections.energy') %></a></p>
        <p class="govuk-body"><a href="#recommendations"><%= t('domestic_epc.sidebar.sections.recommendations') %></a></p>
        <p class="govuk-body"><a href="#heat-demand"><%= t('domestic_epc.sidebar.sections.heat-demand') %></a></p>
        <p class="govuk-body"><a href="#information"><%= t('domestic_epc.sidebar.sections.information') %></a></p>
        <% if assessment.has_key?(:greenDealPlan) %>
          <p class="govuk-body"><a href="#green_deal"><%= t('domestic_epc.sidebar.sections.green_deal') %></a></p>
        <% end %>
        <% unless assessment[:relatedAssessments] == [] || assessment[:relatedAssessments].nil? %>
          <p class="govuk-body"><a href="#related_asssesments"><%= t('domestic_epc.sidebar.sections.related_asssesments') %></a></p>
        <% end %>
        <!-- <p class="govuk-body"><a href="#previous"><%= t('domestic_epc.sidebar.sections.previous') %></a></p> -->
      </div>
    </div>
  </div>
  <div class="govuk-grid-column-two-thirds">
    <hr class="epc-light-top" />
    <div class="govuk-body epc-blue-bottom">
      <div class="epc-box govuk-!-margin-bottom-5">
        <div class="epc-rating-box">
          <p class="epc-rating-title govuk-body">
            <%= t('domestic_epc.summary.energy_rating_title') %>
          </p>
          <p class="epc-rating-result govuk-body">
            <%= assessment[:currentEnergyEfficiencyBand].upcase %>
          </p>
        </div>
        <p class="epc-address govuk-body">
          <%== [assessment[:addressLine1], assessment[:addressLine2], assessment[:addressLine3], assessment[:addressLine4]].reject(&:nil?).join('<br />') %><br>
          <%= assessment[:town] %><br />
          <%= assessment[:postcode] %>
        </p>
        <p class="govuk-body epc-extra-box"><%= t('domestic_epc.summary.date_of_expiry', :date_of_expiry => Date.parse(assessment[:dateOfExpiry]).strftime('%-d %B %Y')) %></p>
        <p class="govuk-body epc-extra-box">
          <label><%= t('domestic_epc.summary.certificate_id') %></label>
          <b><%= assessment[:assessmentId] %></b>
        </p>
      </div>

      <p class="govuk-body"><%== t(
               'domestic_epc.summary.property_info',
              dwelling_type: assessment[:dwellingType],
              total_floor_area: "%g" % assessment[:totalFloorArea]
       ) %></p>

      <div>
        <a onclick="window.print();return false;" class="govuk-link govuk-!-margin-bottom-5" id="link" href="#" style="display: none;"><%= t('domestic_epc.summary.print_certificate') %></a>
        <noscript><p class="govuk-body"><%= t('domestic_epc.summary.print_certificate_noscript') %></p></noscript>
        <script>document.getElementById('link').style.display = 'block';</script>
      </div>
    </div>
  </div>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-body epc-blue-bottom">
      <a id="renting"></a>
      <h2 class="govuk-heading-l"><%= t('domestic_epc.sections.renting.title') %></h2>
      <% minimum_energy_rating_for_rentals = 'e' %>
      <% if assessment[:currentEnergyEfficiencyBand] > minimum_energy_rating_for_rentals %>
        <div class="govuk-warning-text">
          <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
          <div class="govuk-warning-text__text">
            <span class="govuk-warning-text__assistive"><%= t('domestic_epc.sections.renting.landlord_warning.hidden_text') %></span>
            <h2 class="govuk-error-summary__title" id="error-summary-title">
              <%= t('domestic_epc.sections.renting.landlord_warning.subtitle') %>
            </h2>
            <div class="govuk-error-summary__body">
              <p class="govuk-body">
                <%== t('domestic_epc.sections.renting.landlord_warning.body.text', :current_energy_efficiency_band => assessment[:currentEnergyEfficiencyBand].upcase) %>
                <%== t('domestic_epc.sections.renting.rental_info.guidance_text', :link => '<a href="' + t('domestic_epc.sections.renting.rental_info.url') + '">' + t('domestic_epc.sections.renting.rental_info.cta') + '</a>') %>
              </p>
              <p class="govuk-body">
                <%== t('domestic_epc.sections.renting.landlord_warning.body.text_2') %>
                <%== t('domestic_epc.sections.renting.landlord_warning.body.recommendations_text', :recommendations_link => '<a href="' + t('domestic_epc.sections.renting.landlord_warning.body.recommendations_url') + '">' + t('domestic_epc.sections.renting.landlord_warning.body.recommendations_cta') + '</a>') %>
              </p>
            </div>
          </div>
        </div>
      <% else %>
        <p class="govuk-body">
          <%== t('domestic_epc.sections.renting.rental_info.body_1') %>
        </p>
        <p class="govuk-body">
          <%== t('domestic_epc.sections.renting.rental_info.body_2') + t('domestic_epc.sections.renting.rental_info.guidance_text', :link => '<a href="' + t('domestic_epc.sections.renting.rental_info.url') + '">' + t('domestic_epc.sections.renting.rental_info.cta') + '</a>' ) %>
        </p>
      <% end %>
    </div>
  </div>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-body epc-blue-bottom">
      <a id="epc"></a>
      <h2 class="govuk-heading-l"><%= t('domestic_epc.sections.epc.title') %></h2>
      <p class="govuk-body govuk-!-margin-bottom-6">
        <%== t('domestic_epc.sections.epc.intro.text', :current_energy_efficiency_band => assessment[:currentEnergyEfficiencyBand].upcase, :potential_energy_efficiency_band => assessment[:potentialEnergyEfficiencyBand].upcase) %>
      </p>
      <p class="govuk-body govuk-!-margin-bottom-6">
        <a href=" <%= t('domestic_epc.sections.epc.intro.url') %>"><%= t('domestic_epc.sections.epc.intro.cta') %></a>
      </p>

      <%== erb :domestic_energy_performance_certificate__energy_rating, locals: {
        current_energy_efficiency_rating: assessment[:currentEnergyEfficiencyRating],
        potential_energy_efficiency_rating: assessment[:potentialEnergyEfficiencyRating],
        current_energy_efficiency_band: assessment[:currentEnergyEfficiencyBand],
        potential_energy_efficiency_band: assessment[:potentialEnergyEfficiencyBand],
        title: t('domestic_epc.sections.epc.aria-label', :current_energy_efficiency_band => assessment[:currentEnergyEfficiencyBand].upcase, :current_energy_efficiency_rating => assessment[:currentEnergyEfficiencyRating], :potential_energy_efficiency_band => assessment[:potentialEnergyEfficiencyBand].upcase, :potential_energy_efficiency_rating => assessment[:potentialEnergyEfficiencyRating] )} %>
      <p class="govuk-body govuk-!-margin-top-6"><%= t('domestic_epc.sections.epc.body1') %></p>
      <p class="govuk-body govuk-!-margin-top-6"><%= t('domestic_epc.sections.epc.body2') %></p>
      <p class="govuk-body govuk-!-margin-top-6"><%= t('domestic_epc.sections.epc.body3') %></p>
      <p class="govuk-body govuk-!-margin-top-6"><%= t('domestic_epc.sections.epc.body4') %></p>
    </div>
  </div>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <%== erb :domestic_energy_performance_certificate__energy_performance_breakdown,
             locals: { assessment: assessment }
    %>
  </div>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <%== erb :domestic_energy_performance_certificate__environmental_impact,
             locals: { assessment: assessment }
    %>
  </div>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <a id="recommendations"></a>
    <h2 class="govuk-heading-l"><%= t('domestic_epc.sections.recommendations.title') %></h2>
    <div class=<%=assessment[:recommendedImprovements].empty? ? 'epc-blue-bottom' : ''%>>
      <div class="epc-rating-box">
        <p class="epc-rating-title govuk-body">
          <%= t('domestic_epc.sections.recommendations.box.energy_rating_title') %>
        </p>
        <p class="epc-rating-result govuk-body">
          <%= assessment[:potentialEnergyEfficiencyBand].upcase %>
        </p>
      </div>
      <% if assessment[:recommendedImprovements].empty? %>
        <p class="govuk-body "><%= t('domestic_epc.sections.recommendations.summary.no_recommendations_summary') %></p>
      <% else %>
        <p class="govuk-body"><%= t('domestic_epc.sections.recommendations.summary.make_changes_text') %></p>
        <p class="govuk-body">
          <%= t('domestic_epc.sections.recommendations.summary.improve_rating_text', :current_energy_efficiency_band => assessment[:currentEnergyEfficiencyBand].upcase, :current_energy_efficiency_rating => assessment[:currentEnergyEfficiencyRating], :potential_energy_efficiency_band => assessment[:potentialEnergyEfficiencyBand].upcase, :potential_energy_efficiency_rating => assessment[:potentialEnergyEfficiencyRating] ) %>
        </p>
        <details class="govuk-details" data-module="govuk-details">
          <summary class="govuk-details__summary">
            <span class="govuk-details__summary-text"><%= t('domestic_epc.sections.recommendations.summary.what_is_energy_rating') %></span>
          </summary>
          <div class="govuk-details__text">
            <%= t('domestic_epc.sections.recommendations.summary.energy_rating_description1') %>
            <br /><br />
            <%= t('domestic_epc.sections.recommendations.summary.energy_rating_description2') %>
            <br /><br />
            <%= t('domestic_epc.sections.recommendations.summary.energy_rating_description3') %>
          </div>
        </details>
      <% end %>
    </div>
  </div>
  <% unless assessment[:recommendedImprovements].empty? %>
    <div class="govuk-grid-column-one-third"><br></div>
    <div class="govuk-grid-column-two-thirds">
      <div class="govuk-body">
        <hr class="epc-light-top"/>
        <% assessment[:recommendedImprovements].each_with_index do |recommendation, index| %>
          <%== erb :domestic_energy_performance_certificate__recommended_improvement, locals: { recommendation: recommendation, index: index } %>
      <% end %>
      </div>
    </div>
  <% end %>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <div class="epc-blue-bottom">
      <h3 class="govuk-heading-m">
        <%= t('domestic_epc.sections.recommendations.paying_for_energy_improvements.title') %>
      </h3>
      <p class="govuk-body">
        <a href="<%= t('domestic_epc.sections.recommendations.paying_for_energy_improvements.link') %>">
          <%= t('domestic_epc.sections.recommendations.paying_for_energy_improvements.text') %>
        </a>
      </p>
    </div>
  </div>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <%== erb :domestic_energy_performance_certificate__estimated_energy_use, locals: { assessment: assessment } %>
  </div>
  <div class="govuk-grid-column-one-third"><br></div>
  <div class="govuk-grid-column-two-thirds">
    <div class="govuk-body epc-blue-bottom">
      <a id="information"></a>
      <h2 class="govuk-heading-l"><%= t('domestic_epc.sections.information.title') %></h2>
      <p class="govuk-body"><%== t('domestic_epc.sections.information.intro') %></p>
      <h3 class="govuk-heading-m"><%= t('domestic_epc.sections.information.assessor.title') %></h3>
      <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row" id="name">
          <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold"><%= t('domestic_epc.sections.information.assessor.list.name') %></dt>
          <dd class="govuk-summary-list__value govuk-!-font-weight-regular"><%= assessment[:assessor][:firstName] %> <%= assessment[:assessor][:lastName] %></dd>
        </div>
        <% if assessment[:assessor][:contactDetails].key?(:telephoneNumber) && !assessment[:assessor][:contactDetails][:telephoneNumber].empty? %>
          <div class="govuk-summary-list__row" id="phone">
            <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold"><%= t('domestic_epc.sections.information.assessor.list.telephone') %></dt>
            <dd class="govuk-summary-list__value govuk-!-font-weight-regular"><%= assessment[:assessor][:contactDetails][:telephoneNumber] %></dd>
          </div>
        <% end %>
        <% if assessment[:assessor][:contactDetails].key?(:email) && !assessment[:assessor][:contactDetails][:email].empty? %>
          <div class="govuk-summary-list__row" id="email">
            <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold"><%= t('domestic_epc.sections.information.assessor.list.email') %></dt>
            <dd class="govuk-summary-list__value govuk-!-font-weight-regular"><a href="mailto:<%= assessment[:assessor][:contactDetails][:email] %>"><%= assessment[:assessor][:contactDetails][:email] %></a></dd>
          </div>
        <% end %>
      </dl>
      <h3 class="govuk-heading-m govuk-!-margin-top-9"><%= t('domestic_epc.sections.information.scheme.title') %></h3>
      <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row" id="Accreditation_scheme">
          <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold"><%= t('domestic_epc.sections.information.scheme.list.name') %></dt>
          <dd class="govuk-summary-list__value govuk-!-font-weight-regular"><%= assessment[:assessor][:registeredBy][:name] %></dd>
        </div>
        <div class="govuk-summary-list__row" id="accreditation_id">
          <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold"><%= t('domestic_epc.sections.information.scheme.list.scheme_assessor_id') %></dt>
          <dd class="govuk-summary-list__value govuk-!-font-weight-regular"><%= assessment[:assessor][:schemeAssessorId] %></dd>
        </div>
        <% unless scheme_details(assessment[:assessor], 'phone').include?('missing')%>
          <div class="govuk-summary-list__row" id="accreditation_id">
            <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold"><%= t('domestic_epc.sections.information.assessor.list.telephone') %></dt>
            <dd class="govuk-summary-list__value govuk-!-font-weight-regular"><%= scheme_details(assessment[:assessor], "phone") %></dd>
          </div>
          <div class="govuk-summary-list__row" id="accreditation_id">
            <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold"><%= t('domestic_epc.sections.information.assessor.list.email') %></dt>
            <dd class="govuk-summary-list__value govuk-!-font-weight-regular">
              <a href="mailto:<%= scheme_details(assessment[:assessor], 'email') %>">
                <%= scheme_details(assessment[:assessor], 'email') %>
              </a>
            </dd>
          </div>
        <% end %>
      </dl>
      <h3 class="govuk-heading-m govuk-!-margin-top-9"><%= t('domestic_epc.sections.information.certificate.title') %></h3>
      <dl class="govuk-summary-list">
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold">
            <%= t('domestic_epc.sections.information.certificate.list.disclosure') %>
          </dt>
          <dd class="govuk-summary-list__value govuk-!-font-weight-regular">
            <%= party_disclosure(assessment[:relatedPartyDisclosureNumber], assessment[:relatedPartyDisclosureText]) %>
          </dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold">
            <%= t('domestic_epc.sections.information.certificate.list.date_of_assessment') %>
          </dt>
          <dd class="govuk-summary-list__value govuk-!-font-weight-regular">
            <%= assessment[:dateOfAssessment] %>
          </dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold">
            <%= t('domestic_epc.sections.information.certificate.list.date_of_certificate') %>
          </dt>
          <dd class="govuk-summary-list__value govuk-!-font-weight-regular">
            <%= assessment[:dateRegistered] %>
          </dd>
        </div>
        <div class="govuk-summary-list__row">
          <dt class="govuk-summary-list__key govuk-!-width-one-half govuk-!-font-weight-bold">
            <%= t('domestic_epc.sections.information.certificate.list.type_of_assessment') %>
          </dt>
          <dd class="govuk-summary-list__value govuk-!-font-weight-regular">
            <details class="govuk-details" data-module="govuk-details">
              <summary class="govuk-details__summary">
                  <span class="govuk-details__summary-text"><%= assessment[:typeOfAssessment] %></span>
              </summary>
              <div class="govuk-details__text" id="description">
                <%= t("domestic_epc.sections.information.certificate.list.#{assessment[:typeOfAssessment].downcase}_description_first_part") %>
                <br /><br />
                <%= t("domestic_epc.sections.information.certificate.list.#{assessment[:typeOfAssessment].downcase}_description_second_part") %>
              </div>
            </details>
          </dd>
        </div>
      </dl>
    </div>
  </div>
  <% if assessment.has_key?(:greenDealPlan) %>
    <%== erb :domestic_energy_performance_certificate__green_deal_plan, locals: { assessment: assessment } %>
  <% end %>

  <% unless assessment[:relatedAssessments] == [] || assessment[:relatedAssessments].nil? %>
    <%== erb :domestic_energy_performance_certificate__related_assessments, locals: { assessment: assessment } %>
  <% end %>
</div>

<div class="sticky">
  <a class="govuk-link cd-top text-replace js-cd-top back-to-top" href="#contents">
  <svg class="app-c-back-to-top__icon" xmlns="http://www.w3.org/2000/svg" width="13" height="17" viewBox="0 0 13 17">
    <path fill="currentColor" d="M6.5 0L0 6.5 1.4 8l4-4v12.7h2V4l4.3 4L13 6.4z"></path>
  </svg>
  Contents
  </a>
</div>
